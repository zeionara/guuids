# Patching packages

For keeping work after each build stage enable `keepwork` feature:

```sh
echo 'FEATURES="keepwork"' | sudo tee /etc/portage/make.conf
```

To patch a package, first of all download and unpack the sources:

```sh
ebuild $(portageq get_repo_path / gentoo)/$category/$package/$package-$version.ebuild unpack
```

where `$package` - package name `$category` is the category, and `$version` is the package version, for example:

```sh
ebuild $(portageq get_repo_path / gentoo)/media-video/obs-studio/obs-studio-32.0.4.ebuild unpack
```

Then edit files that you want to patch:

```sh
sudo vim /var/tmp/portage/$category/$package-$version/work/$package-$version/file.cpp
```

Then build patched version:

```sh
ebuild $(portageq get_repo_path / gentoo)/$category/$package/$package-$version.ebuild prepare compile
```

And install the binaries:

```sh
ebuild $(portageq get_repo_path / gentoo)/$category/$package/$package-$version.ebuild install merge
```

To recompile the package:

```sh
sudo rm /var/tmp/portage/$category/$package-$version/.compiled
sudo ebuild $(portageq get_repo_path / gentoo)/$category/$package/$package-$version.ebuild compile install merge
```

There is an [example][patching-obs] of instruction on patching a specific package.

[patching-obs]: https://github.com/zeionara/mullins-obs-pipewire
