# Installing graphical and media tools

In this chapter we go through configuring graphical and media tools for enabling convenient experience on the device.

## Configure wayland compositor

Install wayland compositor of your choice to enable graphical applications. I recommend using [Hyprland][Hyprland]. To install it, emerge the required packages:

```sh
sudo emerge --ask gui-wm/hyprland
```

It will likely ask you to update `/etc/portage/package.use/installkernel`. To confirm the update, run:

```sh
sudo etc-update
```

Then type:

```sh
1
1
yes
```

Then try to emerge again, this time everything should be fine.

### Update profile

Add the following lines to your `.zprofile`:

```sh
if test -z "${XDG_RUNTIME_DIR}"; then
    export XDG_RUNTIME_DIR=/tmp/${UID}-runtime-dir
    if ! test -d "${XDG_RUNTIME_DIR}"; then
        mkdir "${XDG_RUNTIME_DIR}"
        chmod 0700 "${XDG_RUNTIME_DIR}"
    fi
fi

dbus-run-session Hyprland
```

And restart the current session. Run the following command to make sure that changes were applied:

```sh
echo $XDG_RUNTIME_DIR
```

### Configure seatd

Enable the following flags for `seatd` package:

```sh
echo "sys-auth/seatd builtin server" | sudo tee /etc/portage/package.use/seatd
```

Then reinstall `seatd` package:

```sh
sudo emerge --ask sys-auth/seatd
```

Add your user to `seat` group:

```sh
sudo gpasswd -a zeio seat
```

Then start `seatd`:

```sh
sudo rc-service seatd start
```

And make it start automatically on boot:

```sh
sudo rc-update add seatd default
```

Now you can start `hyprland` using command to verify that the basic setup is completed:

```sh
dbus-run-session Hyprland
```

Press 'Super + M` to exit `hyprland`.

To configure hyprland to spawn terminal instance on `Super + Enter`, web browser on `Super + F` and quit the active window on `Super + Q`, edit '~/.config/hypr/hyprland.conf` like this:

```sh
$terminal = alacritty
$webBrowser = firefox

bind = $mainMod, Q, killactive,
bind = $mainMod, RETURN, exec, $terminal
bind = $mainMod, F, exec, $webBrowser
```

To enable multiple layouts:

```sh
input {
    kb_layout = us,ru
    kb_options = grp:win_space_toggle
}
```

To decrease repeat delay:

```sh
input {
    repeat_delay = 200
    repeat_rate = 30
}
```

To enable opacity:

```sh
decoration {
    active_opacity = 0.8
    inactive_opacity = 0.8
}
```

Optimal value of gaps size depends on the screen:

::: tabs

=== Small screens (~1366x768)

```sh
general {
    gaps_in = 5
    gaps_out = 5
}
```

:::

### Configure cursor size and theme

There are many [cursor themes][hyprcursor] discussed at the `#hyprcursor-themes` section of the [hyprland discord channel][hyprland-discord]. I recommend using [rose-pine-hyprcursor][rose-pine-hyprcursor] or converted version of [phinger cursors][phinger-cursors].

#### Configure rose-pine-hyprcursor theme

To install `rose-pine-hyprcursor` theme, you need to download the `.tar.gz` archive with icons. Use the original repo or my cloud storage:

::: tabs

== Download from the developer's repo

Run the following command:

```sh
wget -P /tmp https://github.com/ndom91/rose-pine-hyprcursor/releases/download/v0.3.2/rose-pine-cursor-hyprcursor_0.3.2.tar.gz
```

== Download from my cloud storage

Run the following command:

```sh
wget -O /tmp/rose-pine-cursor-hyprcursor_0.3.2.tar.gz https://zeio.s3.cloud.ru/shared/themes/rose-pine-hyprcursor-0.3.2.tar.gz
```

:::

Then unpack [rose-pine-hyprcursor][rose-pine-hyprcursor] theme to `~/.local/share/icons` like this:

```sh
mkdir -p $HOME/.local/share/icons/rose-pine-hyprcursor
tar -xzvf /tmp/rose-pine-cursor-hyprcursor_0.3.2.tar.gz -C $HOME/.local/share/icons/rose-pine-hyprcursor
```

Add the following content to the `~/.config/hypr/hyprland.conf`:

```sh
env = XCURSOR_SIZE,20
env = XCURSOR_THEME,rose-pine-hyprcursor
env = HYPRCURSOR_SIZE,20
env = HYPRCURSOR_THEME,rose-pine-hyprcursor
```

#### Configure phinger-hyprcursors-light theme

::: warning Limited cursor size support

`Phinger cursors` theme supports a limited set of cursor sizes - `24`, `32`, `48`, `64`, `96` and `128`. That is why I wouldn't recommend using it.

:::

To install the converted version of [phinger cursors][phinger-cursors], download the following file from my cloud storage:

```sh
wget -P /tmp https://zeio.s3.cloud.ru/shared/themes/phinger-hyprcursors-light.tar.gz
```

Create `~/.local/share/icons` folder if it does not exist:

```sh
if test ! -d $HOME/.local/share/icons; then mkdir $HOME/.local/share/icons; fi
```

Then unpack the downloaded archive to `~/.local/share/icons` like this:

```sh
tar -xzvf /tmp/phinger-hyprcursors-light.tar.gz -C $HOME/.local/share/icons
```

Add the following content to the `~/.config/hypr/hyprland.conf`:

```sh
env = XCURSOR_SIZE,24
env = XCURSOR_THEME,phinger-hyprcursors-light
env = HYPRCURSOR_SIZE,24
env = HYPRCURSOR_THEME,phinger-hyprcursors-light
```

Now, before switching to `GUI` we still need to perform a couple of additional steps.

## Configure terminal emulator

I recommend using [alacritty][alacritty], which can be installed using this command:

```sh
sudo emerge --ask x11-terms/alacritty
```

In case there are some changes to local USE flags of other packages that should be applied, use `etc-update` tool.

::: tip Listing enabled use flags for a package

To list USE flags currently enabled for a package, run the following command:

```sh
equery u x11-terms/alacritty
```

:::

After `alacritty` is installed, create config directory:

```sh
if test ! -d $HOME/.config/alacritty; then mkdir $HOME/.config/alacritty; fi
```

And make a minimal configuration file, which may look like this:

::: tabs

=== Small screens (~1366x768)

```sh
cat <<EOF > $HOME/.config/alacritty/alacritty.toml
[mouse]
bindings=[
{ mouse = "Right", action = "Copy" }
]

[window]
padding = { x = 5, y = 5 }

[font]
size = 10
EOF
```

:::

## Configure pipewire

Enable a couple of local use-flags:

```sh
echo 'media-video/pipewire sound-server pipewire-alsa' | sudo tee /etc/portage/package.use/pipewire
```

Add `dbus` service to run level `boot`:

```sh
sudo rc-update add dbus boot
```

And start the service in current session:

```sh
sudo rc-service dbus start
```

Since `pipewire` is currently not supported in `OpenRC`, add the following command to `~/.config/hypr/hyprland.conf` to run `pipewire` on startup:

```sh
exec-once = gentoo-pipewire-launcher
```

### Troubleshooting

Install the following packages for testing `sound` devices through `alsa`:

```sh
sudo emerge --ask media-sound/alsa-utils
```

List devices visible to `alsa`:

```sh
aplay -l
```

## Configure desktop portal

To install `xdg-desktop-portal-hyprland`, enable the `guru` repository:

```sh
sudo eselect repository enable guru
sudo emerge --sync guru
```

Add required keywords for the package and its dependencies:

```sh
echo "gui-libs/xdg-desktop-portal-hyprland ~amd64" | sudo tee /etc/portage/package.accept_keywords/xdg-desktop-portal-hyprland
echo "dev-cpp/sdbus-c++ ~amd64" | sudo tee -a /etc/portage/package.accept_keywords/xdg-desktop-portal-hyprland
```

::: warning Long-running command

The following command might take a lot of time depending on your hardware (on 4-core `AMD A8 6410` it took 5 hours), because it will compile and install a `qt-base` dependency.

:::

Emerge the package:

```sh
sudo emerge --ask gui-libs/xdg-desktop-portal-hyprland
```

Create the following script to start `xdg-desktop-portal-hyprland` automatically:

```sh
cat <<EOF > $HOME/.config/hypr/xdg-desktop-portal-hyprland.sh
#!/bin/bash
sleep 1
killall xdg-desktop-portal-hyprland
killall xdg-desktop-portal-gnome
killall xdg-desktop-portal-wlr
killall xdg-desktop-portal
logger 'killed all xdg-desktop'
sleep 1
/usr/libexec/xdg-desktop-portal-hyprland &
logger 'xdg-desktop-portal-hyprland started'
sleep 2
/usr/libexec/xdg-desktop-portal &
logger 'xdg-desktop-portal started'
EOF
```

Set the permissions:

```sh
chmod +x $HOME/.config/hypr/xdg-desktop-portal-hyprland.sh
```

And update `$HOME/.config/hypr/hyprland.conf' like this:

```sh
env = XDG_CURRENT_DESKTOP, Hyprland
env = XDG_SESSION_TYPE, wayland
env = XDG_SESSION_DESKTOP, Hyprland
exec-once = dbus-update-activation-environment --systemd WAYLAND_DISPLAY XDG_CURRENT_DESKTOP
exec-once = ~/.config/hypr/xdg-desktop-portal-hyprland.sh
```

## Configure OBS

Enable `~amd64` keyword for `OBS`:

```sh
echo "media-video/obs-studio ~amd64" | sudo tee /etc/portage/package.accept_keywords/obs-studio
```

Enable some local USE flags:

```sh
echo "media-video/obs-studio pipewire speex vlc websocket truetype pulseaudio" | sudo tee /etc/portage/package.use/obs-studio
```

Install `OBS`:

```sh
sudo emerge --ask media-video/obs-studio
```

## Configure web browser

Now we are going to install web browser. I recommend using [firefox][firefox] because it is open-sourced and has an [explicit privacy policy][firefox-privacy].
First, I recommend enabling some local USE flags:

```sh
echo 'www-client/firefox hwaccel openh264 system-pipewire' | sudo tee /etc/portage/package.use/firefox
```

::: warning Long-running command

The following command might take a lot of time depending on your hardware (on 4-core `AMD A8 6410` it took 5 hours), because it will compile and install a heavy package.

:::

Then run the following command to install firefox:

```sh
sudo emerge --ask www-client/firefox
```

Add the following line to `~/.config/hypr/hyprland.conf` to enable opening `OBS` on pressing `Super + O`:

```sh
bind = $mainMod, O, exec, obs,
```

## Configure telegram messenger

Emerge the required packages:

```sh
sudo emerge --ask net-im/telegram-desktop
```

It will likely ask you for local USE flag changes, use `etc-update` to apply the suggested updates.

Add the following line to `~/.config/hypr/hyprland.conf` to enable opening `telegram` on pressing `Super + T`:

```sh
bind = $mainMod, T, exec, Telegram,
```

In case there are some changes to local USE flags of other packages that should be applied, use `etc-update` tool.

[Hyprland]: https://hypr.land
[hyprland-discord]: https://discord.com/invite/hQ9XvMUjjr&ved=2ahUKEwjCt6XvqbiSAxWEnP0HHdduD8AQFnoECAwQAQ&usg=AOvVaw22E8GwZpX7TAr8rXz10fKj
[hyprcursor]: https://wiki.hypr.land/Hypr-Ecosystem/hyprcursor
[rose-pine-hyprcursor]: https://github.com/ndom91/rose-pine-hyprcursor
[phinger-cursors]: https://github.com/phisch/phinger-cursors
[alacritty]: https://github.com/alacritty/alacritty
[firefox]: https://www.firefox.com
[firefox-privacy]: https://www.mozilla.org/privacy/firefox
